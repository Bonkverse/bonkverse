{% extends 'skins/base.html' %}

{% block title %}Upload a Bonk.io Skin{% endblock %}

{% block content %}
  <h1>Upload a Bonk.io Skin</h1>

  <!-- Django flash messages -->
  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <!-- Who is submitting -->
  <p class="muted">You’re uploading as: <strong>{{ user.username }}</strong></p>

  <div id="loading" style="display:none;">
    <p>⏳ Uploading and processing your skin... Please wait!</p>
  </div>

  <div class="form-container">
    <form id="upload-form" method="POST" action="{% url 'upload_skin' %}" onsubmit="return validateForm()">
      {% csrf_token %}

      <label for="skin_name">Skin Name</label>
      <input type="text" id="skin_name" name="skin_name" placeholder="Enter skin name..." required maxlength="1000">

      <label for="bonkleagues_link">Bonkleagues Skin URL</label>
      <input type="url" id="bonkleagues_link" name="bonkleagues_link" placeholder="https://bonkleagues.io/s/ABCDEFG" required>

      <p id="error-message" class="error" style="display:none; color:red;"></p>

      <button type="submit">Upload Skin</button>
    </form>
  </div>

  <script>
    function validateForm() {
      const skinName = document.getElementById("skin_name").value.trim();
      const bonkleaguesLink = document.getElementById("bonkleagues_link").value.trim();
      const errorMessage = document.getElementById("error-message");

      const bonkRegex = /^https:\/\/bonkleagues\.io\/s\/[A-Za-z0-9]{7}$/;

      if (!skinName || !bonkleaguesLink) {
        errorMessage.innerText = "All fields are required.";
        errorMessage.style.display = "block";
        return false;
      }

      if (skinName.length > 1000) {
        errorMessage.innerText = "Skin name must be under 1000 characters.";
        errorMessage.style.display = "block";
        return false;
      }

      if (!bonkRegex.test(bonkleaguesLink)) {
        errorMessage.innerText = "Invalid Bonkleagues link format.";
        errorMessage.style.display = "block";
        return false;
      }

      showLoading();
      return true;
    }

    function showLoading() {
      document.getElementById("loading").style.display = "block";
      document.getElementById("upload-form").style.display = "none";
    }
  </script>
{% endblock %}
